import numpy as np
import matplotlib.pyplot as plt
from p2 import * #get dataframes from previous problem
import pandas as pd
import datetime as dt
import seaborn as sns
sns.set_context('poster')


#Problem 3a: Add a new column for Obama-Romney

polls['Diff']=(polls.Obama-polls.Romney)/100
electionday=dt.datetime(2012,11,06)
weekBefore=polls[map(lambda x: ((x-electionday).days)>=-7,polls['Start Date'])]
weekBefore['daysBefore']=map(lambda x: (x-electionday).days, weekBefore['Start Date'])

#Problem 3b: Plot the percentage difference between Obama and Romney in polls taken one week before election day

pollsterColor={}
for p in set(weekBefore.Pollster):
    pollsterColor[p]=(np.random.rand(), np.random.rand(), np.random.rand())
    
plt.figure()
plt.scatter(weekBefore['daysBefore'],weekBefore['Diff'],color=map(lambda x: pollsterColor[x], weekBefore.Pollster))
plt.axhline(0.039,0,1,color='red',label='Actual percent difference on election day')
plt.axhline(np.mean(weekBefore['Diff']),color='blue',label='Mean percent difference among polls')
plt.title('Percent difference between Obama and Romney')
plt.xlabel('Days before election')
plt.ylabel('Percent difference according to polls')
plt.legend()


#Problem 3c: Plot the differences between poll-predicted difference and actual difference by pollster

grouped = polls.groupby(['Pollster','Affiliation'])
percentByPollster=grouped['Diff'].mean()  #If a pollster made more than one poll, average the results
plt.figure()
plt.bar(np.arange(len(percentByPollster)),percentByPollster)
plt.xlim([0,len(percentByPollster)])
plt.title('Poll-predicted percent difference - actual election day difference')
plt.xlabel('Pollsters (see Pollsters printout for names)')
plt.ylabel('Difference between polls and actual results')

#print table showing the names of the pollsters next to their predicted Obama-Romney differences (no space to put names on plot)

print percentByPollster.reset_index()   #add number indexes next to pollster names to make it easier to reference on plot


#Problem 3d: 




